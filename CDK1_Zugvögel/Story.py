import streamlit as st
import matplotlib.pyplot as plt
import numpy as np
import pandas as pd
from PIL import Image
import base64

def add_bg_from_local(image_file):
    with open(image_file, "rb") as image:
        encoded = base64.b64encode(image.read()).decode()
    st.markdown(
         f"""
         <style>
         .stApp {{
             background-image: url("data:image/png;base64,{encoded}");
             background-size: cover;
             background-position: top center;
             background-attachment: fixed;
             color: black;
         }}
         </style>
         """,
         unsafe_allow_html=True
     )

add_bg_from_local('Daten/Bilder/back.png')

st.markdown("""
<div style='
    background-color: rgba(255, 255, 255, 0.6);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    padding: 2rem;
    border-radius: 15px;
    margin: 2rem auto;
    width: 100%;
    color: black;
'>

<h2 style='text-align: center;'>Die V√∂gel bleiben ‚Äì und mit ihnen kommt das Ungleichgewicht</h2>
<h3 style='text-align: center;'>Wie der Klimawandel den Vogelzug ver√§ndert</h3>

<!-- Einleitung: Flachsee & Verbindung zur Vogelwelt -->
<p>
Der Flachsee im Reusstal ist ein beliebter Ort f√ºr Naturbeobachtungen und ein √∂kologisch wertvolles Gebiet im Kanton Aargau. 
Besonders im Fr√ºhling und Herbst lassen sich hier zahlreiche Zugv√∂gel beobachten, darunter auch Arten, die fr√ºher nur im Sommer oder gar nicht in der Region anzutreffen waren.
</p>
<p>
Der Ort bietet uns einen direkten Einblick in eine tiefgreifende Ver√§nderung: 
Das Zugverhalten vieler Vogelarten wandelt sich. 
Mildere Winter und ver√§nderte Nahrungsverf√ºgbarkeit f√ºhren dazu, dass immer mehr V√∂gel nicht mehr in ihre angestammten Winterquartiere ziehen, sondern den Winter √ºber in der Schweiz bleiben.
</p>

<!-- Einf√ºhrung zum Fokus: der Storch -->
<p>
Besonders auff√§llig ist dieser Wandel beim Weissstorch. 
Jahrzehntelang war er im Winter kaum in der Schweiz anzutreffen. 
Heute jedoch lassen sich auch w√§hrend der kalten Monate immer mehr St√∂rche beobachten, selbst bei Schnee und Eis. 
Der einstige Langstreckenzieher wird zunehmend zum Standvogel.
</p>
<p>
Diese Entwicklung wirft Fragen auf: Wie stark hat sich das Verhalten des Weissstorchs ver√§ndert? Welche Rolle spielt der Klimawandel dabei? Und was bedeutet das f√ºr die √ñkologie in der Schweiz und in Afrika?
</p>



<!-- Klimawandel und den einfluss auf V√∂gel -->

""", unsafe_allow_html=True)

col1, col2 = st.columns(2)
with col1:
    st.image("Daten/Bilder/storch_schnee.webp", use_container_width=True)

with col2:
    st.image("Daten/Bilder/Flachsee.jpg", caption="Flachsee im Aargau", use_container_width=True)



st.markdown("""
<div style='
    background-color: rgba(255, 255, 255, 0.6);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    padding: 2rem;
    border-radius: 15px;
    margin: 2rem auto;
    width: 100%;
    color: black;
'>


<h4>Ein Vogel im Wandel: Der Weissstorch</h4>
            
<!-- elaborate on the stork -->
            
<p>
Noch vor wenigen Jahrzehnten war der Weissstorch ein typischer Sommergast in der Schweiz. 
Im Herbst zog er in grossen Schw√§rmen nach Afrika, um dort zu √ºberwintern. 
Doch heute zeigt sich ein neues Bild: 
Immer h√§ufiger werden St√∂rche auch in den Wintermonaten beobachtet, 
selbst bei Schnee und tiefen Temperaturen. 
Besonders entlang des Juras√ºdfusses, am Bodensee oder in 
Feuchtgebieten wie dem Flachsee lassen sich √ºberwinternde Individuen nachweisen.
</p>
""", unsafe_allow_html=True)    

df = pd.read_csv("Daten/Voegeldaten/storchenzahlen_2017_2025.csv")

# Prozentanteil Winterst√∂rche berechnen
df["Anteil_Winter"] = (df["Winterstoerche"] / (df["Brutstoerche"] + df["Winterstoerche"])) * 100

fig, ax = plt.subplots(figsize=(12, 6))
bar_width = 0.4
x = range(len(df))

farben = {
    "brut": "#A9D3F0",
    "winter": "#B0B0B0"
}

ax.bar([i - bar_width/2 for i in x], df["Brutstoerche"], width=bar_width, label="Brutst√∂rche", color=farben["brut"])
ax.bar([i + bar_width/2 for i in x], df["Winterstoerche"], width=bar_width, label="Winterst√∂rche", color=farben["winter"])

for i, pct in enumerate(df["Anteil_Winter"]):
    ax.text(i + bar_width/2, df["Winterstoerche"][i] + 50, f"{pct:.1f}%", ha='center', fontsize=9)

ax.set_xticks(x)
ax.set_xticklabels(df["Jahr"], rotation=45)
ax.set_ylabel("Anzahl St√∂rche")
ax.set_title("Winter-Storchz√§hlungen in der Schweiz (2017‚Äì2025)")
ax.legend()
fig.tight_layout()

st.pyplot(fig)


st.markdown("""
<div style='
    background-color: rgba(255, 255, 255, 0.6);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    padding: 2rem;
    border-radius: 15px;
    margin: 2rem auto;
    width: 100%;
    color: black;
'>
            
<!-- Klimawandel und den Einfluss auf V√∂gel -->

<p>
Die Gr√ºnde f√ºr das ver√§nderte Zugverhalten vieler Vogelarten sind vielf√§ltig: 
Mildere Winter, verf√ºgbare Nahrung auf offenen Feldern oder Kompostpl√§tzen und ein geringerer Energieverbrauch durch k√ºrzere Flugstrecken 
machen es f√ºr viele Arten attraktiv, √ºber den Winter in der Schweiz zu bleiben.
</p>

<p>
Doch diese Anpassung an ver√§nderte klimatische Bedingungen hat ihren Preis: 
Das √∂kologische Gleichgewicht ger√§t ins Wanken ‚Äì sowohl in der Schweiz als auch in den urspr√ºnglichen √úberwinterungsgebieten in Afrika. 
Der Klimawandel wirkt dabei wie ein schleichender Verst√§rker: Er ver√§ndert nicht nur das Verhalten einzelner Arten, 
sondern auch das Zusammenspiel ganzer √ñkosysteme.
</p>

<p>
Die folgende Grafik zeigt, wie sich die durchschnittliche Jahrestemperatur in der Schweiz unter verschiedenen 
Klimaszenarien (RCP 2.6, 4.5 und 8.5) bis Ende des Jahrhunderts entwickeln k√∂nnte. 
Je nach globalem Emissionsverlauf steigen die Temperaturen unterschiedlich stark an ‚Äì mit direkten Folgen 
f√ºr Lebensr√§ume, Nahrungsketten und das saisonale Verhalten vieler Tierarten wie dem Weissstorch.
</p>
""", unsafe_allow_html=True)

# CSVs einlesen
rcp26 = pd.read_csv("Daten/temperatur_szenarien/tas_yearly_RCP2.6_CH_transient.csv")
rcp45 = pd.read_csv("Daten/temperatur_szenarien/tas_yearly_RCP4.5_CH_transient.csv")
rcp85 = pd.read_csv("Daten/temperatur_szenarien/tas_yearly_RCP8.5_CH_transient.csv")

# Helper-Funktion
def preprocess(df, label):
    df_long = df.melt(id_vars=["tas"], var_name="Jahr", value_name="Temperatur")
    df_long["Jahr"] = df_long["Jahr"].astype(int)
    df_long["Szenario"] = label
    return df_long.groupby(["Jahr", "Szenario"])["Temperatur"].mean().reset_index()

# Daten vorbereiten
df_26 = preprocess(rcp26, "RCP 2.6")
df_45 = preprocess(rcp45, "RCP 4.5")
df_85 = preprocess(rcp85, "RCP 8.5")

# Zusammenf√ºhren
df_all = pd.concat([df_26, df_45, df_85])

# Plot
fig, ax = plt.subplots(figsize=(12, 6))
farben = {
    "RCP 2.6": "#1f77b4",
    "RCP 4.5": "#ff7f0e",
    "RCP 8.5": "#d62728"
}

for scenario in df_all["Szenario"].unique():
    data = df_all[df_all["Szenario"] == scenario]
    ax.plot(data["Jahr"], data["Temperatur"], label=scenario, color=farben[scenario])

ax.set_xlabel("Jahr")
ax.set_ylabel("√ò Temperatur [¬∞C]")
ax.set_title("Temperaturentwicklung in der Schweiz (nach RCP-Szenarien)")
ax.grid(True)
ax.legend()
fig.tight_layout()

st.pyplot(fig)

st.markdown("""
<div style='
    background-color: rgba(255, 255, 255, 0.6);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    padding: 2rem;
    border-radius: 15px;
    margin: 2rem auto;
    width: 100%;
    color: black;
'>


<!-- andere Arten -->

<p>
Der Weissstorch ern√§hrt sich vor allem von Insekten, Regenw√ºrmern, Amphibien, kleinen S√§ugetieren und gelegentlich auch Fischen. 
In einem typischen Winter war diese Nahrung fr√ºher in der Schweiz kaum verf√ºgbar ‚Äì der Boden war gefroren, die Tiere im Winterschlaf oder inaktiv.
</p>
<p>
Doch mit den steigenden Wintertemperaturen √§ndern sich diese Bedingungen: Der Boden friert vielerorts nicht mehr durch, Amphibien sind fr√ºher aktiv und Kompostpl√§tze bieten ganzj√§hrig Nahrung.
Diese Entwicklung macht die Schweiz auch im Winter zu einem geeigneten Lebensraum ‚Äì mit weitreichenden Folgen f√ºr die einheimischen √ñkosysteme.
</p>


<p>
Der Weissstorch ist nicht allein. 
Auch Arten wie der <strong>Mauersegler</strong> oder die <strong>Rauchschwalbe</strong> ver√§ndern ihr Zugverhalten. 
W√§hrend sie fr√ºher zuverl√§ssig nach Zentralafrika flogen, bleiben heute mehr Tiere √ºber l√§ngere Zeitr√§ume in der Schweiz, 
einige sogar ganzj√§hrig.
</p>

<!-- üìä GRAFIK-VORSCHLAG:
    Vergleich: Anzahl gemeldeter Sichtungen Mauersegler/Rauchschwalbe im Winter
    Typ: gestapeltes Balkendiagramm nach Art & Jahr
-->

<p>
Gerade bei insektenfressenden Arten wirkt sich das unmittelbar auf die √ñkosysteme aus: 
Ein h√∂herer Jagddruck auf heimische Insektenpopulationen im Winter versch√§rft bestehende R√ºckg√§nge. 
Gleichzeitig fehlen diese V√∂gel als Fressfeinde oder Nahrung in ihren afrikanischen Winterquartieren,
was dort zu Ungleichgewichten f√ºhrt.
</p>

<!-- üåç GRAFIK-VORSCHLAG:
    Zwei Karten nebeneinander:
    - CH: Dichte √ºberwinternder V√∂gel (z.‚ÄØB. Storch, Schwalbe)
    - Afrika: R√ºckgang gemeldeter Winterbeobachtungen
-->

""", unsafe_allow_html=True)

st.image("Daten/Bilder/problem.png", use_container_width=True)

st.markdown("""
<div style='
    background-color: rgba(255, 255, 255, 0.6);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    padding: 2rem;
    border-radius: 15px;
    margin: 2rem auto;
    width: 100%;
    color: black;
'>
<!-- √∂kologische Folgen Flachsee, Schweiz und Afrika -->
<!-- √∂kologische Folgen -->
            
<p>
In der Schweiz kommt es zunehmend zu Konkurrenz zwischen Zugv√∂geln, die bleiben, und Standv√∂geln wie Amsel oder Meise. Nahrung, Nistpl√§tze und Lebensr√§ume werden knapper. Das kann zu Verdr√§ngung f√ºhren ‚Äì oder zu ver√§nderten Brutzeiten mit erh√∂htem Risiko f√ºr Brutverluste.
</p>

<!-- üìà GRAFIK-VORSCHLAG:
    Modellhafte Darstellung oder Diagramm:
    Brutbeginn vs. Insektenverf√ºgbarkeit (z.‚ÄØB. ‚ÄûMismatch‚Äú)
    Typ: 2 Kurven auf Zeitachse (Fr√ºhling), zeitliche Verschiebung zeigen
-->

<p>
Gleichzeitig fehlen die V√∂gel im S√ºden als Samenverbreiter, 
Sch√§dlingsvertilger oder Nahrungsquelle f√ºr andere Tiere. 
Damit gehen wichtige √∂kologische Funktionen verloren, ein oft untersch√§tzter Aspekt des Klimawandels.
</p>

<!-- üå± GRAFIK-VORSCHLAG:
    Infografik oder Flussdiagramm:
    "√ñkologische Rollen der Zugv√∂gel" ‚Äì Schweiz vs. Afrika
    (Samenverbreitung, Nahrung, Sch√§dlingskontrolle)
-->
              
<!-- abschluss / Fazit -->
<!-- Quellen -->
</div>         

""", unsafe_allow_html=True)
